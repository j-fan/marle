import{Y as b,Z as C,_ as E,P as v,S as D,i as k,s as W,k as I,l as O,m as T,h as P,n as y,b as q,O as G,A as S,J as H,o as F,Q as M}from"./index-b357ccce.js";import{A as N,S as x,W as R,f as z,C as J}from"./pixi-7ebbcd1d.js";import{w as Q}from"./index-05d5dca7.js";import{s as V}from"./PixiWaterAsync-f9d88d7b.js";import{g as A}from"./store-8a0a2259.js";function j(e){return Object.prototype.toString.call(e)==="[object Date]"}function _(e,t){if(e===t||e!==e)return()=>e;const s=typeof e;if(s!==typeof t||Array.isArray(e)!==Array.isArray(t))throw new Error("Cannot interpolate values of different type");if(Array.isArray(e)){const a=t.map((i,n)=>_(e[n],i));return i=>a.map(n=>n(i))}if(s==="object"){if(!e||!t)throw new Error("Object cannot be null");if(j(e)&&j(t)){e=e.getTime(),t=t.getTime();const n=t-e;return r=>new Date(e+r*n)}const a=Object.keys(t),i={};return a.forEach(n=>{i[n]=_(e[n],t[n])}),n=>{const r={};return a.forEach(c=>{r[c]=i[c](n)}),r}}if(s==="number"){const a=t-e;return i=>e+i*a}throw new Error(`Cannot interpolate ${s} values`)}function Y(e,t={}){const s=Q(e);let a,i=e;function n(r,c){if(e==null)return s.set(e=r),Promise.resolve();i=r;let l=a,d=!1,{delay:m=0,duration:f=400,easing:w=v,interpolate:o=_}=b(b({},t),c);if(f===0)return l&&(l.abort(),l=null),s.set(e=i),Promise.resolve();const g=C()+m;let u;return a=E(h=>{if(h<g)return!0;d||(u=o(e,r),typeof f=="function"&&(f=f(e,r)),d=!0),l&&(l.abort(),l=null);const p=h-g;return p>f?(s.set(e=r),!1):(s.set(e=u(w(p/f))),!0)}),a.promise}return{set:n,update:(r,c)=>n(r(i,e),c),subscribe:s.subscribe}}function Z(e){let t,s,a,i,n;return{c(){t=I("div"),this.h()},l(r){t=O(r,"DIV",{class:!0,style:!0}),T(t).forEach(P),this.h()},h(){y(t,"class",s=e[0]+" pixi-canvas svelte-1k5qfmg"),y(t,"style",a=e[1]?"filter: grayscale();":void 0)},m(r,c){q(r,t,c),i||(n=G(t,"click",e[6]),i=!0)},p(r,[c]){c&1&&s!==(s=r[0]+" pixi-canvas svelte-1k5qfmg")&&y(t,"class",s),c&2&&a!==(a=r[1]?"filter: grayscale();":void 0)&&y(t,"style",a)},i:S,o:S,d(r){r&&P(t),i=!1,n()}}}function B(e,t,s){let a,{imageSrc:i}=t,{displacePower:n=20}=t,{canvasId:r}=t,{isGrayscale:c=!1}=t;const l=new N({resizeTo:document.body}),d=x.from("https://raw.githubusercontent.com/j-fan/marle-images/main/jane/img/displacement_map.jpeg");d.texture.baseTexture.wrapMode=R.REPEAT;const m=new z.DisplacementFilter(d),f=Y(0,{duration:600,easing:V});H(e,f,o=>s(5,a=o)),F(()=>{document.querySelector(`.${r}`).appendChild(l.view),l.stage.interactive=!0;const g=new J;l.stage.addChild(g);const u=x.from(i);if(typeof i=="object"&&"clientHeight"in i){const{width:h,height:p}=A(i.clientWidth,i.clientHeight,window.innerWidth,window.innerHeight);u.width=h,u.height=p}else if(typeof i=="string"){const{width:h,height:p}=A(16,9,window.innerWidth,window.innerHeight);u.width=h,u.height=p}return g.addChild(u),l.stage.addChild(d),u.filters=[m],m.padding=10,m.scale.x=n,m.scale.y=n,l.ticker.add(()=>{d.x++,d.x>d.width&&(d.x=0)}),()=>{l.destroy(!0)}});function w(o){M.call(this,e,o)}return e.$$set=o=>{"imageSrc"in o&&s(3,i=o.imageSrc),"displacePower"in o&&s(4,n=o.displacePower),"canvasId"in o&&s(0,r=o.canvasId),"isGrayscale"in o&&s(1,c=o.isGrayscale)},e.$$.update=()=>{e.$$.dirty&16&&f.set(n),e.$$.dirty&32&&(m.scale.x=a,m.scale.y=a)},[r,c,f,i,n,a,w]}class ee extends D{constructor(t){super(),k(this,t,B,Z,W,{imageSrc:3,displacePower:4,canvasId:0,isGrayscale:1})}}export{ee as default};
